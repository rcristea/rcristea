---
interface Props {
  sectionCount: number;
}

const { sectionCount } = Astro.props;
---

<div class="scroll-indicator">
  {Array.from({ length: sectionCount }).map((_, index) => (
    <div
      class="scroll-indicator__dot"
      data-index={index}
    />
  ))}
</div>

<style>
  .scroll-indicator {
    position: fixed;
    bottom: 2rem;
    right: 2rem;
    display: flex;
    flex-direction: column;
    gap: 0.75rem;
    z-index: 1000;
  }

  .scroll-indicator__dot {
    width: 12px;
    height: 12px;
    border-radius: 50%;
    background-color: var(--background-light);
    transition: background-color 0.3s ease;
    cursor: pointer;
  }

  .scroll-indicator__dot.active {
    background-color: var(--primary-main);
  }
</style>

<script>
  function initScrollIndicator() {
    const handleScroll = () => {
      const scrollPosition = window.scrollY + window.innerHeight / 2;
      const sections = document.querySelectorAll('[data-section]');
      const dots = document.querySelectorAll('.scroll-indicator__dot');
      
      sections.forEach((section, index) => {
        const rect = section.getBoundingClientRect();
        const sectionTop = window.scrollY + rect.top;
        const sectionBottom = sectionTop + rect.height;
        
        if (scrollPosition >= sectionTop && scrollPosition < sectionBottom) {
          dots.forEach((dot, dotIndex) => {
            dot.classList.toggle('active', dotIndex === index);
          });
        }
      });
    };

    handleScroll();
    window.addEventListener('scroll', handleScroll, { passive: true });
    window.addEventListener('resize', handleScroll, { passive: true });
  }

  initScrollIndicator();
  
  document.addEventListener('astro:after-swap', initScrollIndicator);
</script>
